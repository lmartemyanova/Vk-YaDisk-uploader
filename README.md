# Резервное копирование

#### ***Программа предназначена для резервного копирования фото из профиля Вконтакте (аватарок) на Яндекс Диск. Также поддерживается автоматическая конвертация изображений из формата HEIC в JPG/PNG.***

## Установка:

1. Клонировать репозиторий.

```bash
git clone https://github.com/lmartemyanova/Vk-YaDisk-uploader
```

2. Перейти в папку проекта:

```bash
cd your_project
```

3. Создать и активировать виртуальное окружение:

- **Windows**:

```bash
python -m venv venv
venv\Scripts\activate
```

- **macOS / Linux**:

```bash
python3 -m venv venv
source venv/bin/activate
```

4. Установить зависимости из ```requrements.txt```: 

```bash
pip install -r requirements.txt
```

## Работа с приложением

1. Получить [ключ доступа к API Вк](https://dev.vk.com/api/access-token/implicit-flow-user) (```access_token```) для **Standalone-приложения**. В параметрах запроса передать ```scope=photos```.

2. Получить токен для **Яндекс.Диска** (```ya_token```):

- Перейдите на страницу [создания приложения](https://oauth.yandex.ru/client/new/id).

- Укажите название, выберите "Веб-сервисы".

- Установите права доступа:

    - ```cloud_api:disk.read```
    - ```cloud_api:disk.write```
    - ```cloud_api:disk.app_folder```
    - ```cloud_api:disk.info```

- После создания приложения, нажмите «Получить токен» (можно указать ```https://oauth.yandex.ru/verification_code``` как редирект).

- Выдайте приложению доступ к вашему Яндекс.Диску — после этого вы получите OAuth-токен, который нужно вставить в ```.env``` как ```ya_token```. 

> Подробнее про получение токена можно прочитать по [ссылке](https://yandex.ru/dev/disk-api/doc/ru/concepts/quickstart#oauth).

3. Получить токен для [ConvertAPI](https://www.convertapi.com/):

Перейдите на [сайт](https://www.convertapi.com/) и зарегистрируйтесь (доступна авторизация через GitHub).

Перейдите в раздел API Secret, сгенерируйте или скопируйте свой ключ (возможна генерация бессрочного ключа).

Вставьте его в ```.env``` как ```api-secret```.

Подробности можно найти в [официальной документации ConvertAPI](https://docs.convertapi.com/).

4. Переименуйте файл ```.env.example``` в ```.env```, затем заполните токены следующим образом:

```bash
access_token=ВАШ_ТОКЕН_ВК  # Ваш токен вк (без кавычек)
ya_token=ВАШ_ТОКЕН_ЯНДЕКС_ДИСКА  # Ваш токен Яндекс диска (без кавычек)
api-secret=ВАШ_API_SECRET_ОТ_CONVERTAPI  # Ваш токен ConvertAPI (без кавычек)
```

5. Запустите код в IDE или выполните в терминале:

```
python main.py
```

______

## Формат получаемых данных:

#### Выгрузка фото из ВК на Яндекс диск

1. Введите id профиля ВК или короткое имя пользователя.

2. Введите id альбома (цифры после _ в ссылке на альбом).

3. Укажите количество фотографий для выгрузки (по умолчанию — все).

4. Фото сохраняются в папку с названием vk_copy_<дата>.

5. Фото именуются по дате загрузки. При совпадении дат добавляется суффикс: 20.01.2015_1, 20.01.2015_2 и т.д.

6. В случае ошибки загрузки, названия проблемных файлов отображаются отдельно.

7. Создаётся JSON-файл с метаданными о загруженных фото.

#### Выгрузка фото в ВК с локального компьютера

1. Введите абсолютный путь к локальной папке с фото.

2. Укажите id профиля ВК или короткое имя пользователя (screen name).
3. Введите id альбома (цифры в адресной строке после знака _).

#### Дополнительные функции Яндекс диска

Если вы загружаете фото с iPhone, велика вероятность, что они будут в формате .heic. Чтобы не конвертировать их вручную, предусмотрен автоматический инструмент (он находится в папке yandex):

1. Перейдите в папку ```yandex```:

```bash
cd yandex
```

2. Запустите:

```bash
python ya_disk-format.py
```

1. Введите название папки на Яндекс.Диске (только имя, без пути).

2. Выберите, в какой формат конвертировать .heic-файлы — .jpg или .png.

После конвертации:

- Новые файлы будут автоматически загружены в ту же папку.

- Оригинальные .heic останутся без изменений.

- Временные файлы удаляются автоматически.

__________

### Предполагаемые модификации:

- Скачивание фото с любого из альбомов пользователя на выбор.
- Скачивание фото на Яндекс Диск, Google Диск или локальный компьютер (по выбору пользователя).
- Обратная выгрузка фото в ВК с Яндекс Диск или Google Диск (пользователь вводит путь к файлам).
- Сохранение по умолчанию всех фото с введенного альбома.
- Доступ ко всем возможностям через чат-бота вконтакте.
